!function(){const e={state:{currentArtwork:{},pixelArray:[]},fonctions:{gatherArtworkSpecs:function(){console.log(typeof o.state.lineNumber),e.state.pixelArray=[],e.state.currentArtwork.author=localStorage.author,e.state.currentArtwork.name=o.state.name,e.state.currentArtwork.lineNumber=o.state.lineNumber,e.state.currentArtwork.pixelNumber=o.state.pixelNumber,document.querySelectorAll(".cell").forEach(t=>{let o=t.style.backgroundColor?t.style.backgroundColor:"rgba(0,0,0,0)";e.state.pixelArray.push(o+"/")}),e.state.currentArtwork.pixels=e.state.pixelArray,console.log("current artwork",e.state.currentArtwork.pixels),localStorage.selectedArtwork?e.fonctions.updateArtwork():e.fonctions.saveArtwork()},saveArtwork:function(){console.log("Bearer "+localStorage.token);let t=o.state.name,n=localStorage.author,r=Number(o.state.lineNumber),a=Number(o.state.pixelNumber),l=""+e.state.pixelArray;fetch("http://54.144.218.140:80/graphql",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.token},body:JSON.stringify({query:"\n                       mutation saveArtwork($author:String!,$name:String!, $linenumber:Int!, $pixelnumber:Int!, $pixels:String! ){\n                           saveArtwork(author:$author,\n                                       name:$name,\n                                       linenumber:$linenumber,\n                                       pixelnumber:$pixelnumber,\n                                       pixels:$pixels\n                                       ) {\n                               name\n                               author\n                               pixels\n                           }\n                       }\n                  ",variables:{now:(new Date).toISOString(),author:n,name:t,linenumber:r,pixelnumber:a,pixels:l}})}).then(e=>e.json()).then(e=>console.log(e))},updateArtwork:function(){fetch("http://54.144.218.140:80/graphql",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.token},body:JSON.stringify({query:`\n                       mutation updateArtwork{\n                           updateArtwork(author:"${localStorage.author}",\n                                       name:"${e.state.currentArtwork.name}",\n                                       linenumber:${e.state.currentArtwork.lineNumber},\n                                       pixelnumber:${e.state.currentArtwork.lineNumber},\n                                       pixels:"${e.state.pixelArray}"\n                                       ) {\n                               name\n                               author\n                               pixels\n                           }\n                       }\n                  `,variables:{now:(new Date).toISOString()}})}).then(e=>e.json()).then(e=>console.log(e))}}},t={domElements:{canvas:document.getElementById("myCanvas")},fonctions:{draw:()=>{const e=t.domElements.canvas.getContext("2d");let n=o.state.pixelNumber;o.state.imageSpecs.forEach(t=>{e.fillStyle=t.color,e.fillRect(t.x*n-n,t.y*n-n,n,n)})},resizeCanvas:()=>{t.domElements.canvas.width=o.state.lineNumber*o.state.pixelNumber,t.domElements.canvas.height=o.state.lineNumber*o.state.pixelNumber}}},o={init:()=>{o.events.addEventLineNumber(o.domElements.form),o.events.addEventToggleColor(),o.events.addEventPixelColor(),o.events.addEventcolorPicker(),o.events.addEventReset(),o.events.addEventCreateImage(),o.events.addEventdownloadImage(),o.events.addEventZommIn(),o.events.addEventSaveArtwork(),o.events.logOut(),o.fonctions.initialSetup(),o.fonctions.logStatus()},domElements:{input:document.querySelectorAll("input"),form:document.querySelector(".configuration"),saveArtworkForm:document.querySelector(".saveArtworkForm"),invaderDiv:document.querySelector("#invader"),changeColorContainer:document.querySelector(".color-container"),colorPicker:document.querySelector(".colorPicker"),resetGrid:document.querySelector(".resetGrid"),createImage:document.querySelector(".createImage"),downloadImage:document.querySelector(".downloadImage"),zoomIn:document.querySelector(".zoomIn"),zoomer:document.querySelector(".zoomer"),currentCells:document.querySelectorAll(".cell"),logMessage:document.querySelector(".logMessage"),logout:document.querySelector(".nav__logout")},state:{name:"",lineNumber:10,pixelNumber:25,colorObject:{empty:"#CCCCCC",plain:"#485460",highlight:"#79EA83",light:"#fbc048"},color:"light",imageSpecs:[],zoomLastValue:0,cell:"",selectedArtwork:[]},fonctions:{createCell:()=>{for(var e=Math.pow(o.state.lineNumber,2),t=0;t<e;t++)o.state.cell=document.createElement("div"),o.state.cell.classList.add("cell"),o.state.cell.style.width=o.state.pixelNumber+"px",o.state.cell.style.height=o.state.pixelNumber+"px",o.state.selectedArtwork.length>0&&(o.state.cell.style.backgroundColor=o.state.selectedArtwork[t]),o.domElements.invaderDiv.appendChild(o.state.cell);o.domElements.zoomer.value=0,o.state.zoomLastValue=0},createCellArray:()=>{o.state.imageSpecs=[];const e=document.querySelectorAll(".cell");let n=0,r=1;e.forEach(e=>{n>o.state.lineNumber-1&&(r++,n=0),n++;let t={};t.x=n,t.y=r,e.style.backgroundColor?t.color=e.style.backgroundColor:t.color="rgba(0,0,0,0)",o.state.imageSpecs.push(t)}),console.log(o.state.imageSpecs),t.fonctions.resizeCanvas(),t.fonctions.draw(),o.domElements.downloadImage.click()},toggleColor:e=>{e.target.style.backgroundColor=o.state.color},changeInvaderSize:()=>{var e=o.state.lineNumber*o.state.pixelNumber;o.domElements.invaderDiv.style.width=e+"px"},removePreviousGrid:()=>{o.domElements.invaderDiv.textContent=""},initialSetup:()=>{if(o.fonctions.createColorButtons(),o.fonctions.applyColorPalette(),localStorage.selectedArtwork){const e=localStorage.getItem("selectedArtwork");o.state.lineNumber=JSON.parse(e).linenumber,o.state.pixelNumber=JSON.parse(e).pixelnumber,o.state.selectedArtwork=JSON.parse(e).pixels.split("/,"),o.state.name=JSON.parse(e).name,console.log(JSON.parse(e).linenumber)}o.fonctions.changeInvaderSize(),o.fonctions.createCell(),o.domElements.zoomer.value=0,o.domElements.saveArtworkForm[0].value=o.state.name},applyColorPalette:()=>{for(let e in o.state.colorObject)document.getElementsByClassName("change--color "+e)[0].style.backgroundColor=o.state.colorObject[e]},createColorButtons:()=>{for(let e in o.state.colorObject){let t=document.createElement("div");t.classList.add("change--color"),t.classList.add(e),o.domElements.changeColorContainer.appendChild(t)}},colorButtonActive:e=>{for(let t in o.state.colorObject)document.getElementsByClassName("change--color "+t)[0].classList.remove("active");e.classList.add("active")},logStatus:()=>{localStorage.token&&(o.domElements.logMessage.textContent=localStorage.author+"  logged in")},reset:()=>{o.fonctions.removePreviousGrid(),o.domElements.invaderDiv.style.width=o.state.lineNumber*o.state.pixelNumber,o.domElements.zoomer.value=0,o.domElements.saveArtworkForm[0].value="",o.state.selectedArtwork=[],o.fonctions.changeInvaderSize(),o.fonctions.createCell()}},events:{addEventLineNumber:e=>{e.addEventListener("submit",e=>{e.preventDefault(),o.state.lineNumber=o.domElements.input[2].value,o.state.pixelNumber=o.domElements.input[3].value,o.fonctions.changeInvaderSize(),o.fonctions.removePreviousGrid(),o.fonctions.createCell()})},addEventToggleColor:()=>{o.domElements.invaderDiv.addEventListener("mousedown",e=>o.fonctions.toggleColor(e))},addEventcolorPicker:()=>{o.domElements.colorPicker.addEventListener("submit",e=>{e.preventDefault();let t=e.target[1].value.trim().replaceAll(" ","_");o.state.colorObject[t]=e.target[0].value,o.domElements.changeColorContainer.textContent="",o.fonctions.createColorButtons(),o.fonctions.applyColorPalette(),o.domElements.colorPicker.reset()})},addEventSaveArtwork:()=>{o.domElements.saveArtworkForm.addEventListener("submit",t=>{t.preventDefault(),o.state.name=t.target[0].value,e.fonctions.gatherArtworkSpecs()})},addEventPixelColor:()=>{o.domElements.changeColorContainer.addEventListener("click",e=>{o.state.color=getComputedStyle(e.target).backgroundColor,o.fonctions.colorButtonActive(e.target)})},addEventReset:()=>{o.domElements.resetGrid.addEventListener("click",()=>{localStorage.removeItem("selectedArtwork"),o.fonctions.reset()})},addEventCreateImage:()=>{o.domElements.createImage.addEventListener("click",()=>{o.fonctions.createCellArray()})},addEventdownloadImage:function(){o.domElements.downloadImage.addEventListener("click",()=>{let e=t.domElements.canvas.toDataURL("image/png");o.domElements.downloadImage.href=e,o.domElements.downloadImage.download="Image.png"})},addEventZommIn:function(){const e=document.getElementsByClassName("cell");o.domElements.zoomer.addEventListener("input",()=>{let t=parseInt(o.domElements.zoomer.value,10),n=parseInt(o.domElements.invaderDiv.style.width,10),r=parseInt(o.state.cell.style.width,10),a=t-o.state.zoomLastValue;o.domElements.invaderDiv.style.width=n+a*o.state.lineNumber+"px",Array.from(e).forEach(e=>{e.style.width=parseInt(e.style.width,10)+a+"px",e.style.height=r+a+"px"}),o.state.zoomLastValue=t})},logOut:function(){o.domElements.logout.addEventListener("click",()=>{localStorage.clear(),o.domElements.logMessage.textContent="",o.fonctions.reset()})}}};document.addEventListener("DOMContentLoaded",o.init)}();loca